<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="robots" content="noindex" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fanfan – Héros d’Arzankia</title>

  <style>
    :root{
      --or:#ffd700;
      --fond:#1b0f2f;
      --texte:#fff8e6;
      --ombre:#000;
      --parch-texte:#3b2a1d;
    }

    body{
      margin:0; padding:0;
      background:url('fond_etoile_perso.webp') center top no-repeat;
      background-color:var(--fond);
      background-size:cover;
      font-family:Georgia, serif;
      color:var(--texte);
      text-shadow:1px 1px 4px var(--ombre);
    }

    .container{ max-width:1200px; margin:auto; padding:1.5rem; text-align:center; }

    h1{ font-size:2.6rem; color:var(--or); text-shadow:0 0 10px #3a1c00; margin:0.2rem 0 0.3rem; }
    .subtitle{ margin:0 0 1rem; opacity:.95; }

    .archives{ margin:0 0 1.5rem; line-height:1.4; }
    .archives q{ font-style:italic; }
    .archives .signature{ display:block; margin-top:0.4rem; font-size:0.9rem; opacity:0.8; }

    /* === Bloc "après-réussite" : photo + parchemin + bouton === */
    .hero-layout{
      display:none;           /* caché par défaut */
      margin-top:0.5rem;
      align-items:flex-start;
      gap:2rem;
    }
    .hero-layout.show{ display:block; }
    @media (min-width: 900px){
      .hero-layout{ display:none; }           /* reste caché tant que pas .show */
      .hero-layout.show{ display:flex; }      /* en desktop : flex quand visible */
    }

    .image-hero{
      width:100%; max-width:700px; border-radius:12px;
      box-shadow:0 0 20px rgba(255,248,230,0.5);
      margin:0.8rem auto 1.2rem; display:block;
    }
    @media (min-width: 900px){
      .image-hero{ width:30%; max-width:560px; margin:0; margin-left:130px; }
    }

    .right-col{ max-width:800px; margin:0 auto; }
    @media (min-width: 900px){ .right-col{ flex:1; max-width:400px; } }

    .parchemin{
      background:url('parchemin_fond.png') center center no-repeat;
      background-size:contain;
      background-color:rgba(255,248,230,0.85);
      color:var(--parch-texte);
      text-shadow:none;
      border-radius:16px;
      box-shadow:0 0 30px rgba(255,240,200,0.5);
      padding:1rem;
      font-size:0.95rem;
      line-height:1.4;
      margin:0 auto 1.5rem;
      opacity:0; transform:translateY(10px);
    }
    .parchemin.show{ animation:fadeIn 0.9s forwards; }
    @keyframes fadeIn{ from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }
    .parchemin p{ margin:0.3rem 0; }

    /* === Jeu === */
    .grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(120px,1fr)); gap:1em; max-width:800px; margin:1.2rem auto 1.6rem; }
    .word{
      padding:.8em; background:#ffffff10; border:2px solid #fff8e6; border-radius:10px;
      cursor:pointer; transition:.25s;
      user-select:none;
    }
    .word.correct.selected{ background:#228855cc; border-color:#66ffcc; }
    .word.wrong.selected{ background:#883333aa; border-color:#ff6666; }

    #reveal{ display:none; margin:1.2rem auto; max-width:600px; font-style:italic; }
    #status{ position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden; } /* aria-live */

    /* Boutons dorés */
    .back-button{
      display:flex; flex-direction:column; align-items:center; gap:1rem;
      margin:0 auto 2rem; width:100%; max-width:260px;
    }
    .back-button a{
      --g1:#fff5c7; --g2:#f3e3a0; --g3:#e2d289; --edge:#d9c889; --shadow:rgba(0,0,0,.28);
      position:relative; display:inline-flex; align-items:center; justify-content:center;
      width:100%; padding:.95em 1.4em; border-radius:15px;
      background:linear-gradient(180deg,var(--g1),var(--g2) 55%,var(--g3));
      border:1px solid var(--edge);
      box-shadow:0 10px 22px var(--shadow), inset 0 1px 0 rgba(255,255,255,.75), inset 0 -2px 6px rgba(0,0,0,.08);
      color:#2a2416; text-decoration:none; font-weight:800; letter-spacing:.2px;
      text-shadow:0 1px 0 rgba(255,255,255,.55);
      transition:transform .15s ease, filter .15s ease;
    }
    .back-button a:hover{ transform:translateY(-2px); filter:saturate(1.05); }

    /* ===== Question "artiste préférée" ===== */
    .question-parch{
      background:url('parchemin_fond.png') center/contain no-repeat;
      background-color:rgba(255,248,230,0.88);
      color:var(--parch-texte);
      text-shadow:none;
      border-radius:16px;
      box-shadow:0 0 30px rgba(255,240,200,.55), 0 0 10px rgba(255,215,0,.15) inset;
      padding:1rem 1.1rem 1.2rem;
      margin:1rem auto 1.3rem;
      max-width:700px;
      opacity:0; transform:translateY(10px);
    }
    .question-parch.show{ animation:fadeIn .9s forwards; }

    .question-parch p{ margin:.4rem 0; }
    .question-parch strong{ color:#5a3d1f; }

    .qa-row{
      display:flex; gap:.6rem; margin-top:.6rem; justify-content:center; flex-wrap:wrap;
    }
    .qa-row input[type="text"]{
      flex:1 1 260px; max-width:360px;
      padding:.7rem .9rem; border-radius:12px; border:1px solid #d9c889;
      background:rgba(255,255,255,.85);
      color:#2a2416; font-size:1rem; outline:none;
      box-shadow:inset 0 1px 3px rgba(0,0,0,.1);
    }
    .qa-row button{
      --g1:#fff5c7; --g2:#f3e3a0; --g3:#e2d289; --edge:#d9c889;
      padding:.8rem 1.1rem; border-radius:12px; border:1px solid var(--edge);
      background:linear-gradient(180deg,var(--g1),var(--g2) 55%,var(--g3));
      font-weight:800; letter-spacing:.2px; color:#2a2416; cursor:pointer;
      box-shadow:0 8px 18px rgba(0,0,0,.22), inset 0 1px 0 rgba(255,255,255,.75), inset 0 -2px 6px rgba(0,0,0,.08);
      transition:transform .15s ease, filter .15s ease;
    }
    .qa-row button:hover{ transform:translateY(-1px); filter:saturate(1.05); }

    .feedback{
      margin-top:.6rem; font-size:1rem; line-height:1.45;
      background:linear-gradient(180deg, rgba(255,248,230,.92), rgba(255,244,210,.92));
      border:1px solid #e2d289; border-radius:12px;
      padding:.7rem .9rem; color:#4a361f;
      box-shadow:0 0 12px rgba(255,215,0,.2) inset;
    }
    .feedback.success{
      border-color:#66ffcc; box-shadow:0 0 0 2px rgba(102,255,204,.25), 0 0 12px rgba(102,255,204,.25) inset;
    }
    .feedback.error{
      border-color:#ff8888; box-shadow:0 0 0 2px rgba(255,136,136,.2), 0 0 12px rgba(255,136,136,.18) inset;
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- Titre + citation -->
    <h1>Fanfan</h1>
    <p class="archives">
      <q> Certaines éclaireuses n’ont pas besoin de lumière pour trouver leur chemin.</q>
      <span class="signature">— Archives de la Tour de l’Aube —</span>
    </p>

    <!-- Jeu-questionnaire -->
    <h2> À quel point connais-tu Fanfan ?</h2>
    <p><em>Clique sur les 5 mots qui lui correspondent vraiment…</em></p>

    <div class="grid" id="wordGrid">
      <div class="word" data-word="Magicienne">Magicienne</div>
      <div class="word" data-word="Hegaia">Hégaïa</div>
      <div class="word" data-word="Aventurière">Aventurière</div>
      <div class="word" data-word="Fidèle">Fidèle</div>
      <div class="word" data-word="Méchante">Méchante</div>
      <div class="word" data-word="Bretagne">Bretagne</div>
      <div class="word" data-word="Chercheuse">Chercheuse</div>
      <div class="word" data-word="Dragon">Dragon</div>
      <div class="word" data-word="Zouppi">Zouppi</div>
      <div class="word" data-word="Chevalière">Chevalière</div>
      <div class="word" data-word="Licorne">Licorne</div>
      <div class="word" data-word="Corse">Corse</div>
    </div>

    <!-- Un SEUL reveal -->
    <div id="reveal">
       <strong>Hello, c'est Fanfan.</strong><br>
      Je sais, Raphaël n’a pas encore exploré mon monde…<br>
      Mais si tu ouvres l’œil, tu pourrais découvrir à quoi il ressemble.<br>
      Rendez-vous sur la page des Mondes d’Arzankia pour percer le secret…
    </div>

    <div id="status" aria-live="polite"></div>

    <!-- Bloc photo + description + bouton (caché tant que le jeu n’est pas réussi) -->
    <section class="hero-layout" id="heroLayout">
      <img src="photo_fanfan.webp" alt="Portrait de Fanfan" class="image-hero" />
      <div class="right-col">
        <div id="fanfan-details" class="parchemin">
          <p><strong>Âge :</strong> 15 ans</p>
          <p><strong>Monde d’origine :</strong> Monde d’Hégaïa</p>
          <p><strong>Clé d’accès :</strong> Chevalière</p>
          <p><strong>Spécialisation :</strong> Chercheuse</p>
          <p><strong>Statut :</strong> En formation – niv 2</p>
          <br>
        </div>

        <!-- Question "artiste préférée" -->
        <div id="quizArtist" class="question-parch" aria-live="polite">
          <p><strong>Hey ! Attends ! Pas si vite !</strong></p>
          <p>J’ai une dernière question pour toi…</p>
          <p><em>Comment s’appelle mon artiste préférée du Monde des Artistes&nbsp;?</em></p>

          <div class="qa-row">
            <input id="artistInput" type="text" placeholder="Écris son prénom…" inputmode="text" autocomplete="off" aria-label="Réponse" />
            <button id="artistValidate" type="button">Valider</button>
          </div>

          <p id="artistFeedback" class="feedback" hidden></p>
        </div>

        <nav class="back-button">
          <a href="3.les_heros.html" aria-label="Retour à la liste des héros">← Les héros d'Arzankia</a>
          <a href="3.les_mondes.html" aria-label="Retour à la liste des héros">← Les Mondes d'Arzankia</a>
        </nav>
      </div>
    </section>
  </div>

  <script>
    // 5 bonnes réponses (attention: data-word="Hegaia" sans accent)
    const correctWords = ["Hegaia","Fidèle","Chercheuse","Chevalière","Corse"];
    let selectedCorrect = new Set();
    let gameCompleted = false;

    const wordEls = document.querySelectorAll('.word');
    const heroLayout = document.getElementById('heroLayout');     // bloc photo+parchemin+retour
    const parch = document.getElementById('fanfan-details');      // parchemin
    const reveal = document.getElementById('reveal');              // texte "Hello, c'est Fanfan."
    const status = document.getElementById('status');

    function hideProfile(){
      if (heroLayout) heroLayout.classList.remove('show');
      if (parch) parch.classList.remove('show');
      if (reveal) reveal.style.display = "none";
    }

    function resetGame(){
      selectedCorrect.clear();
      gameCompleted = false;
      wordEls.forEach(w => w.classList.remove('selected','correct','wrong'));
      hideProfile();
    }

    function showProfile(){
      if (heroLayout) heroLayout.classList.add('show');
      if (parch) setTimeout(()=>parch.classList.add('show'), 20); // lance l'anim du parchemin
      if (reveal) reveal.style.display = "block";
      status.textContent = "Fiche de Fanfan déverrouillée.";
    }

    wordEls.forEach(wordEl=>{
      wordEl.addEventListener('click', ()=>{
        if (gameCompleted) return;

        const word = wordEl.dataset.word;
        if (wordEl.classList.contains('selected')) return;

        if (correctWords.includes(word)){
          wordEl.classList.add('selected','correct');
          selectedCorrect.add(word);
          if (selectedCorrect.size === correctWords.length){
            gameCompleted = true;
            showProfile();
          }
        } else {
          wordEl.classList.add('selected','wrong');
          status.textContent = "Oups, mauvaise réponse. On recommence !";
          setTimeout(resetGame, 500);
        }
      });
    });

    // cache tout au chargement
    hideProfile();

    /* ===== Quiz artiste préférée ===== */
    const quizArtist = document.getElementById('quizArtist');
    const artistInput = document.getElementById('artistInput');
    const artistValidate = document.getElementById('artistValidate');
    const artistFeedback = document.getElementById('artistFeedback');

    // Normalise : minuscules, supprime accents/espaces/punctuations
    function norm(s){
      return (s||"")
        .normalize('NFD').replace(/[\u0300-\u036f]/g,'') // accents
        .toLowerCase().replace(/[^a-z]/g,'');            // letters only
    }

    // Variantes tolérées : Aurélyne / Aurelyne / Auréline / Aureline (+ éventuellement "Louboutin")
    const OK = new Set(['aurelyne','aureline']);
    function isCorrectAnswer(v){
      const n = norm(v);
      return OK.has(n) || n.startsWith('aurelyne') || n.startsWith('aureline') || n.includes('louboutin');
    }

    function showArtistFeedback(ok){
      artistFeedback.hidden = false;
      if(ok){
        artistFeedback.classList.remove('error');
        artistFeedback.classList.add('success');
        artistFeedback.innerHTML = "🎉 <strong>Bien joué&nbsp;!</strong> C’est exact. <strong>Aurélyne</strong> est une artiste incroyable.<br>As-tu visité sa boutique&nbsp;?<br><em>Petite astuce&nbsp;:</em> si la porte est fermée et qu’Aurélyne est à l’intérieur, <strong>toc trois fois à la porte</strong> et elle t’ouvrira&nbsp;!";
      }else{
        artistFeedback.classList.remove('success');
        artistFeedback.classList.add('error');
        artistFeedback.textContent = "🤔 Pas tout à fait… Essaie encore ! (Indice : son prénom commence par « Au… »)";
      }
    }

    // apparition progressive du bloc question quand la fiche apparaît
    function revealQuizArtist(){
      if(!quizArtist) return;
      setTimeout(()=> quizArtist.classList.add('show'), 250);
    }

    // branchement validation
    if(artistValidate && artistInput){
      artistValidate.addEventListener('click', ()=>{
        showArtistFeedback(isCorrectAnswer(artistInput.value));
      });
      artistInput.addEventListener('keydown', (e)=>{
        if(e.key === 'Enter'){
          showArtistFeedback(isCorrectAnswer(artistInput.value));
        }
      });
    }

    // On étend showProfile pour déclencher l'apparition du quiz
    const _origShowProfile = showProfile;
    window.showProfile = function(){
      _origShowProfile();
      revealQuizArtist();
    };
  </script>
</body>
</html>
